# YOLO開発計画

## 概要
椎体検出と骨折分類のための現代的なYOLO実装を開発する。PyTorchベースで高精度・高速な推論を実現する。

## 現状分析
- `YOLO/` ディレクトリは開発開始前の状態
- `prior_YOLO_file/` には既存のKeras/TensorFlow YOLOv3実装
- `Sakaguchi_file/` にはResNet18ベースの椎体骨折分類システム

## 開発計画

### フェーズ1: 環境とアーキテクチャの設計
**目標**: 現代的なYOLOフレームワークの導入とプロジェクト構造の構築

1. **YOLOフレームワークの選択**
   - YOLOv8 (ultralytics) を採用
   - PyTorchベースの実装
   - より高精度で高速な推論が可能

2. **プロジェクト構造の設計**
   ```
   YOLO/
   ├── data/           # データセット管理
   │   ├── raw/        # 生データ
   │   ├── processed/  # 前処理済みデータ
   │   └── annotations/# アノテーションファイル
   ├── models/         # モデル定義とチェックポイント
   ├── training/       # 学習スクリプト
   ├── inference/      # 推論スクリプト
   ├── utils/          # ユーティリティ関数
   │   ├── data_prep.py    # データ前処理
   │   ├── medical_utils.py # 医療画像処理
   │   └── evaluation.py   # 評価関数
   ├── configs/        # 設定ファイル
   └── notebooks/      # 実験用ノートブック
   ```

3. **技術スタック**
   - PyTorch 2.x
   - Ultralytics YOLOv8
   - nibabel (医療画像処理)
   - OpenCV (画像処理)
   - Weights & Biases (実験管理)

### フェーズ2: データ処理パイプラインの実装
**目標**: 医療画像データの前処理とYOLO形式への変換

1. **医療画像データの前処理**
   - NIfTIファイルから2Dスライスの抽出
   - 椎体領域の検出とクロッピング
   - 画像の正規化と前処理

2. **YOLOデータセットの構築**
   - 椎体検出用のバウンディングボックスアノテーション
   - 骨折分類用のラベル付け
   - データ拡張の実装（回転、スケール、輝度調整）

3. **既存データの活用**
   - `Sakaguchi_file/` の前処理済みデータの利用
   - `input_nii/` の生データとcut_li座標の活用
   - `prior_YOLO_file/` の知見とコードの参考

### フェーズ3: モデル学習と評価
**目標**: YOLOモデルの学習と性能評価

1. **YOLOモデルの学習**
   - 椎体検出タスク（物体検出）
   - 骨折分類タスク（分類）
   - ハイパーパラメータ最適化

2. **学習設定**
   - Transfer learning（COCOデータセット事前学習）
   - 医療画像特有の損失関数の検討
   - クロスバリデーション

3. **性能評価と比較**
   - 既存手法（ResNet18）との比較
   - 医療画像特有の評価指標（感度、特異度、AUC）
   - 推論速度の測定

### フェーズ4: 推論システムの構築
**目標**: 実用的な推論システムの開発

1. **推論パイプライン**
   - リアルタイム推論システム
   - バッチ処理システム
   - 結果の可視化

2. **統合システム**
   - 既存のSakaguchi_file/システムとの比較
   - 統合評価システム

## 開発方針

### 技術選択の理由
- **PyTorch**: 研究開発に適している、既存プロジェクトと一貫性
- **YOLOv8**: 最新の精度と速度、医療画像への適用実績
- **Ultralytics**: 使いやすいAPI、豊富なドキュメント

### 既存資産の活用
- `Sakaguchi_file/` の前処理パイプラインを参考
- `prior_YOLO_file/` の医療画像処理知見を活用
- 学習済みモデルとの性能比較

### 今後の展開
1. **段階的開発**: フェーズごとに検証と改良
2. **実験管理**: Weights & Biasesで詳細な実験記録
3. **性能比較**: 既存手法との定量的比較
4. **実用化**: 臨床現場での利用を想定した最適化

## 次のステップ
1. フェーズ1の環境構築から開始
2. プロジェクト構造の作成
3. 依存関係の定義（pyproject.toml更新）
4. データ前処理パイプラインの実装